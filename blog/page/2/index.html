
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>jtimberman's Code Blog</title>
  <meta name="author" content="Joshua Timberman">

  
  <meta name="description" content="I wrote the following as a non-technical analogy for a variety of &#8220;as a service&#8221; cloud type providers.AWS gives you the entire play gr...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://jtimberman.github.com/blog/page/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="jtimberman's Code Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">jtimberman's Code Blog</a></h1>
  
    <h2>Topics include: Opscode Chef, configuration management, Ruby, Linux/Unix administration. Opinions expressed here are my own and do not reflect those of my employer (Opscode, Inc.).</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:jtimberman.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/01/non-technical-analogy-for-as-a-service-providers/">Non-technical Analogy for &#8220;as a Service&#8221; Providers</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-06-01T00:00:00-06:00" pubdate  data-updated="true" >Jun 1<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wrote the following as a non-technical analogy for a variety of &#8220;as a service&#8221; cloud type providers.</p>
<p>AWS gives you the entire play ground, for the most part. You can do pretty much anything you want, and they give you some really cool pre-made toys to put in it.</p>
<p>Engine Yard is more like a sandbox. You can come play in the sandbox, but they make the rules and you have to use their buckets and shovels.</p>
<p>Heroku is just the bucket. You can&#8217;t look inside, you just put your sand in and they mold it into the sandcastle.</p>
<p>Rackspace is more like the entire park where the playground is. There&#8217;s other stuff there, and you can make use of it while you visit. They have a few sandboxes, and you can build your own section.</p>
<p>Opscode is like the construction company. We provide the tools and materials needed to build all the sandboxes, buckets, and parks. Each of the others can use Opscode in whole or in part of building their playground or park.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/28/installing-virtualbox-on-osx-with-chef/">Installing Virtualbox on OSX With Chef</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-05-28T00:00:00-06:00" pubdate  data-updated="true" >May 28<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There&#8217;s a rumor floating around that I automate everything on my laptop with Chef, including <a href="https://twitter.com/#!/jtimberman/status/73450718429847552" target="_blank">window maximizing</a>. While that&#8217;s not entirely true, I do automate as much as possible on my <a href="http://jtimberman.posterous.com/managing-my-workstations-with-chef" target="_blank">workstations with Chef</a>, as I have three laptops I use regularly. One application I like to have installed is VirtualBox, because I do some Chef recipe testing with it and <a href="http://vagrantup.com" target="_blank">Vagrant</a>.</p>
<p>I did the most natural thing ever, I wrote a cookbook to automate installation of VirtualBox on OS X. The disk image file that Oracle distributes for VirtualBox on OSX uses an &#8220;mpkg&#8221; installer package, so I couldn&#8217;t just use the dmg_package LWRP I wrote to install it in /Applications. I extended the dmg_package provider to allow a type to be specified and pushed a new release of the <a href="http://community.opscode.com/cookbooks/dmg" target="_blank">dmg cookbook (v.0.6.0)</a>. The recipe in my cookbook builds the URL, which may seem convoluted (maybe it is), but it makes it more dynamic and customizable with fewer assumptions. The actual usage looks like this:</p>
<p><script src="https://gist.github.com/997134.js"></script></p>
<p>One thing to note about the mpkg type, is that these generally want to install in /Applications, which often requires root privileges. The dmg_package LWRP will use sudo when performing the mpkg installation, so if you&#8217;re like my and want to run chef-client as a non-root user for most things, it will prompt for your password, unless you unlock sudo in the same shell. Output of VirtualBox being installed:</p>
<p><code>
<div class="CodeRay">
  <div class="code"><pre>INFO: Processing dmg_package[Virtualbox] action install (virtualbox::default line 41)
INFO: Processing remote_file[/Users/jtimberman/.chef/cache/Virtualbox.dmg] action create (/Users/jtimberman/.chef/cache/cookbooks/dmg/providers/package.rb line 36)
INFO: Processing execute[hdid /Users/jtimberman/.chef/cache/Virtualbox.dmg] action run (/Users/jtimberman/.chef/cache/cookbooks/dmg/providers/package.rb line 42)
INFO: execute[hdid /Users/jtimberman/.chef/cache/Virtualbox.dmg] sh(hdid /Users/jtimberman/.chef/cache/Virtualbox.dmg)
/dev/disk1                  Apple_partition_scheme                 
/dev/disk1s1                Apple_partition_map                    
/dev/disk1s2                Apple_HFS                              /Volumes/VirtualBox
INFO: execute[sudo installer -pkg /Volumes/Virtualbox/Virtualbox.mpkg -target /] sh(sudo installer -pkg /Volumes/Virtualbox/Virtualbox.mpkg -target /)
Password: &lt;-- unlock sudo before running to avoid this prompt. &quot;sudo -l&quot; should be sufficient.
installer: Package name is Oracle VM VirtualBox
installer: Upgrading at base path /
installer: The upgrade was successful.
INFO: execute[hdiutil detach '/Volumes/Virtualbox'] sh(hdiutil detach '/Volumes/Virtualbox')
&quot;disk1&quot; unmounted.
&quot;disk1&quot; ejected.
INFO: Processing file[/Applications/Virtualbox.app/Contents/MacOS/Virtualbox] action create (/Users/jtimberman/.chef/cache/cookbooks/dmg/providers/package.rb line 55)
ERROR: file[/Applications/Virtualbox.app/Contents/MacOS/Virtualbox] (/Users/jtimberman/.chef/cache/cookbooks/dmg/providers/package.rb line 55) had an error: Operation not permitted - /Applications/Virtualbox.app/Contents/MacOS/Virtualbox
INFO: Chef Run complete in 36.219113 seconds
INFO: Running report handlers
INFO: Resources updated this run:
INFO:   execute[hdid /Users/jtimberman/.chef/cache/Virtualbox.dmg]
INFO:   execute[sudo installer -pkg /Volumes/Virtualbox/Virtualbox.mpkg -target /]
INFO:   execute[hdiutil detach '/Volumes/Virtualbox']
INFO: Report handlers complete</pre></div>
</div>

</code></p>
<p>After writing and testing, the next thing I wanted to do is share the cookbook on the Opscode Chef Community site. However, I discovered that the good Chris Peplin already shared one! Since the site has a flat namespace, I would have to name mine differently. However, I think it would be better to collaborate in true Open Source fashion with Chris, and we&#8217;ll collaborate on this.&nbsp;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/06/switching-to-gnu-emacs/">Switching to GNU Emacs</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-05-06T00:00:00-06:00" pubdate  data-updated="true" >May 6<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have a confession to make.</p>
<p>For those who follow me on <a href="http://twitter.com/jtimberman" target="_blank">Twitter</a>, you already know. For those who read the title of this post, you can make an educated guess.</p>
<p>After ~16 years of using Vi/Vim/MacVim, I&#8217;m switching my primary editor to Emacs. Over the years, I have tried to use Emacs without much progress. I never really gave enough effort to learn it. In fact, only in the last year did I learn all the movement keys (C-f, C-b, C-n, C-p). To say I made uneducated disparaging comments about Emacs would be an understatement.</p>
<p>I have a highly customized Vim/MacVim setup, with lots of bells and whistles like NERDtree, Command-T, language plugins <a href="https://github.com/jtimberman/dotvim" target="_blank">and more</a>&nbsp;derived from Adam Jacob&#8217;s <a href="https://github.com/adamhjk/adam-vim" target="_blank">repository</a>. I&#8217;ve spent countless hours tweaking and customizing it further to enhance productivity.</p>
<p>So how did I come around and completely switch editors? It wasn&#8217;t easy, that&#8217;s for sure. First there&#8217;s the resistance to a new tool. However, I wanted to keep a truly open mind, and give it a real, honest attempt. I bought the <a href="http://amzn.com/0596006489" target="_blank">O&#8217;Reilly Learning GNU Emacs</a> book and started reading, with the editor open to one of my favorite things to edit, my ~/chef-repo.</p>
<p>Actually the first thing I did was get a sensible and sane configuration started. I forked Phil Hagelberg&#8217;s excellent&nbsp;<a href="https://github.com/technomancy/emacs-starter-kit">Emacs Starter Kit</a>. I also thought AquaMacs would be the sensible place to start, since I&#8217;m using a Mac, and it uses a lot of familiar OS X hotkeys for copy/paste, opening and closing tabs and more. However, some fellow Opscode coworkers advised against AquaMacs, especially with the starter kit, because it leads one down a path of really &#8220;non-standard&#8221; Emacs settings. That isn&#8217;t entirely awful, since I manage my <a href="jtimberman.posterous.com/managing-my-workstations-with-chef" target="_blank">workstation(s) with Chef</a> and have my Emacs config available first thing on a new machine (now that its added in, anyway :)). However, I quickly became annoyed with some erratic behavior. For example, opening a tab, then having something like a completion window means that switching tabs will keep the completion window persisted, even though it was split on &#8220;a different tab&#8221;.&nbsp;</p>
<p>So I switched to GNU Emacs, and have been using that for the last week. I have no measure of whether my productivity is increased or not, but I&#8217;m getting pretty comfortable with the editor, and able to do most of what I was really good at in Vim. I sometimes miss Command-T, but the default Emacs file fine (C-x C-f for those that don&#8217;t know) is really good. Some of the things that I have found to be totally essential and are what keep me using the editor:</p>
<p>Buffers are totally sane, very fast to switch between, and easy to navigate between open files. Also related, the half hour or so I spent learning and practising the basics - create horizontal and veritical split, opening files in new windows, and more was totally worth it. I&#8217;m actually getting to be faster than the panels used in Vim, which I&#8217;ve been using for ~4 years.</p>
<p>File navigation is awesome. I really liked &#8221;<img src="http://km.support.apple.com/library/APPLE/APPLECARE_ALLGEOS/HT1343/ks_command.gif" alt="" />-T&#8221; in the short time I used TextMate, and I loved <a href="http://weblog.jamisbuck.org/2008/10/10/coming-home-to-vim" target="_blank">FuzzyFileFinder</a> and <a href="http://www.vim.org/scripts/script.php?script_id=3025" target="_blank">Command-T plugins</a> for Vim. However the flexiblity of the built-in default file navigation in Emacs is really intuitive for me.</p>
<p>With the Emacs starter-kit, some good modes are installed and available by default without modification. Most of the time I&#8217;m using Ruby, Markdown or Javascript modes. I anticipate starting in on org-mode at some point, but as I&#8217;m still getting comfortable with the basics, we&#8217;ll take some baby steps :).</p>
<p>Emacs really is easy to customize. I never really did much with Vim. I certainly cargo culted other configs, went with what worked, and left it at that. With Emacs, I&#8217;m doing that, but the code I&#8217;m looking at is more sensible to me. I hope this doesn&#8217;t mean I&#8217;m going to go learn Lisp :). As I&#8217;ve forked emacs-starter-kit on GitHub, and made my own customizations, I&#8217;m also sharing those back on the site, so if you want to see what changes I&#8217;ve made and additional modes I&#8217;ve installed, <a href="https://github.com/jtimberman/emacs-starter-kit" target="_blank">take a peek</a>. If you look, there&#8217;s a chef.el the &#8220;jtimberman&#8221; directory with some shortcuts to drop off common Chef resources. As I learn more, I plan to make that a bit more useful as snippets or maybe even a chef-mode.</p>
<p>Speaking of custom modes, even if I didn&#8217;t use it for anything else, Emacs is totally worth using for confluence-mode. We have two Confluence wikis, one for Chef, and an internal company wiki. Confluence mode seems to assume you only have one wiki, and I haven&#8217;t sorted out the details on how to easily switch between the two. For now I just put the confluence-url setting in the *scratch* buffer and do M-x eval-region to &#8220;switch&#8221;. That said, the ability to quickly search for a page and load the confluence wiki markup page in a buffer, then save the content back out to the wiki directly is *awesome*. No more 4 step process to copy/paste the markup into an editor window and back out to the form. Also, while there&#8217;s a Vim syntax plugin for Confluence, I had no end of error trying to use it.</p>
<p>As I&#8217;ve only been using Emacs for a week, I&#8217;m still a novice. However, I&#8217;ve gotten to the point where I can get what I need done in writing Chef cookbooks and documentation. I&#8217;m enjoying the learning process, and pleased that I&#8217;m at a point where the editor is not only out of the way, but helping me get more done.</p>
<p>The potential to devolve into an editor war is high, so please, no comments about how other editors are better or that I should switch back to Vim. I firmly believe that everyone should use tools that they enjoy, and that help them be productive. Snarky comments can be made on twitter, of course :).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/24/a-simple-report-handler/">A Simple Report Handler</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-04-24T00:00:00-06:00" pubdate  data-updated="true" >Apr 24<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://tickets.opscode.com/browse/CHEF-2179" title="Exception and Report Handlers" target="_blank">Exception and report handlers</a> are a pretty cool feature of Chef. They have been around for several versions (<a href="http://www.opscode.com/blog/2010/06/21/chef-0-9-0-and-ohai-0-5-6-released/" title="Chef 0.9.0 Release Post" target="_blank">first appearing in 0.9.0</a>), but haven&#8217;t received a lot of attention. In the Chef Advanced training class, we go into greater detail about writing handlers, so I had a play with them a bit recently. Also, the default logging output for a chef-client run is a bit more verbose in Chef 0.10 than it was in previous versions. <a href="http://tickets.opscode.com/browse/CHEF-2179" title="CHEF-2179" target="_blank">I&#8217;ve been convinced</a> this is for the better overall, though all the &#8220;Processing&#8230;&#8221; lines can get in the way of things that are actually being configured. To make it clearer of what resources were actually configured in the Chef run, I wrote a very simple handler:</p>
<p><script src="https://gist.github.com/940171.js"></script></p>
<p>To use this in my chef-client, I drop it off as a file, say &#8220;/var/lib/chef/handler/updated_resources.rb&#8221; and then configure /etc/chef/client.rb:</p>
<p><script src="https://gist.github.com/940176.js"></script></p>
<p>Then when I run chef-client, after the run is complete it will display something like this:</p>
<div class="CodeRay">
  <div class="code"><pre>[Sun, 24 Apr 2011 22:50:58 -0600] INFO: Chef Run complete in 15.297228 seconds
[Sun, 24 Apr 2011 22:50:58 -0600] INFO: Running report handlers
[Sun, 24 Apr 2011 22:50:58 -0600] INFO: Resources updated this run:
[Sun, 24 Apr 2011 22:50:58 -0600] INFO:   execute[apt-get update]
[Sun, 24 Apr 2011 22:50:58 -0600] INFO:   execute[index-gem-repository]
[Sun, 24 Apr 2011 22:50:58 -0600] INFO:   remote_directory[/srv/gems/gems]
[Sun, 24 Apr 2011 22:50:58 -0600] INFO: Report handlers complete</pre></div>
</div>

<p><strong>Update</strong>: I released a <a href="https://rubygems.org/gems/chef-handler-updated-resources">gem for this handler</a>. You can now install the gem and then use <code>require 'chef/handler/updated_resources'</code> in /etc/chef/client.rb</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/22/chef-0-10-s-knife-plugins/">Chef 0.10&#8217;s Knife Plugins</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-04-22T00:00:00-06:00" pubdate  data-updated="true" >Apr 22<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Earlier today^Wyesterday, Opscode previewed a new feature of the upcoming Chef 0.10, <a href="http://www.opscode.com/blog/2011/04/22/chef-0-10-preview-knife-plugins-and-ui/" title="Chef 0.10 Preview: Knife Plugins" target="_blank">Knife Plugins</a>. I&#8217;ve been excited about this feature since Dan DeLeo first created the <a href="http://tickets.opscode.com/browse/CHEF-1248" title="CHEF-1248" target="_blank">ticket for it</a>. I already created the &#8220;grep&#8221; plugin that Dan illustrates on the blog post, and it is quite useful already (and I only have a few systems!).</p>
<p>A few months ago, I wrote a <a href="https://rubygems.org/gems/ubuntu_ami" title="UbuntuAmi RubyGem" target="_blank">silly library</a> that will retrieve the list of Canonical&#8217;s released AMIs. They make this available as a text file per distribution codename (lucid, maverick, etc), and my library supports that. For even greater silliness, but perhaps usefulness, I wrote a knife plugin to retrieve the AMI data. The code is really simple.</p>
<p><script src="https://gist.github.com/938399.js"></script></p>
<p>The run method processes the name_args (see the <a href="http://wiki.opscode.com/display/chef/Knife+Plugins" title="Knife Plugins" target="_blank">Knife Plugin Documentation</a>) for the distribution and optionally a type. Lets see an example of what this means.</p>
<p>First, usage:</p>
<div class="CodeRay">
  <div class="code"><pre>% knife ec2 amis ubuntu -h
knife ec2 amis ubuntu DISTRO [TYPE]
    -s, --server-url URL             Chef Server URL
    -k, --key KEY                    API Client Key
        --color                      Use colored output
    -c, --config CONFIG              The configuration file to use
        --defaults                   Accept default values for all questions
    -e, --editor EDITOR              Set the editor to use for interactive commands
    -E, --environment ENVIRONMENT    Set the Chef environment
    -F, --format FORMAT              Which format to use for output
        --no-color                   Don't use colors in the output
    -n, --no-editor                  Do not open EDITOR, just accept the data as is
    -u, --user USER                  API Client Username
        --print-after                Show the data after a destructive operation
    -V, --verbose                    More verbose output. Use twice for max verbosity
    -v, --version                    Show chef version
    -y, --yes                        Say yes to all prompts for confirmation
    -h, --help                       Show this message</pre></div>
</div>

<p>The name_args we can pass are DISTRO and TYPE, TYPE being optional. The rest of the options are built into knife and available to every sub-command. Let&#8217;s pick a distro. My favorite these days is lucid:</p>
<div class="CodeRay">
  <div class="code"><pre>% knife ec2 amis ubuntu lucid
ap_northeast_large:      ami-580fa459
ap_northeast_large_ebs:  ami-5e0fa45f
ap_northeast_small:      ami-4c0fa44d
ap_northeast_small_ebs:  ami-5c0fa45d
ap_southeast_large:      ami-c692ec94
ap_southeast_large_ebs:  ami-f092eca2
ap_southeast_small:      ami-2492ec76
ap_southeast_small_ebs:  ami-f292eca0
eu_west_large:           ami-631f2b17
eu_west_large_ebs:       ami-3d1f2b49
eu_west_small:           ami-a11e2ad5
eu_west_small_ebs:       ami-311f2b45
us_east_large:           ami-fa01f193
us_east_large_ebs:       ami-3202f25b
us_east_small:           ami-7000f019
us_east_small_ebs:       ami-3e02f257
us_west_large:           ami-e1bfefa4
us_west_large_ebs:       ami-f5bfefb0
us_west_small:           ami-19bfef5c
us_west_small_ebs:       ami-ebbfefae</pre></div>
</div>

<p>For the DISTRO, I can use any of the codenames that Canonical makes available, including karmic, lucid, maverick and even natty at the time of this writing. The value on the left is the TYPE. Lets see what happens when I pass one of those:</p>
<div class="CodeRay">
  <div class="code"><pre>% knife ec2 amis ubuntu lucid us_west_small
ami-19bfef5c</pre></div>
</div>

<p>This returns just the AMI. We can feed this into an environment variable or just copy and paste it into a &#8220;knife ec2 server create&#8221; command for the &#8220;-I ami&#8221; option.</p>
<p>A note about the naming, I classed it under the ec2 sub-command space since it is most relevant there. Further, I used &#8220;amis ubuntu&#8221; rather than &#8220;ubuntu amis&#8221; because theoretically other plugins could be written to retrieve other platforms. There&#8217;s a couple bugs I know about already and will fix them later. Enjoy!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/11/display-chef-server-search-indexes/">Display Chef Server Search Indexes</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-04-11T00:00:00-06:00" pubdate  data-updated="true" >Apr 11<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Anyone who runs a Chef Server or uses the Opscode Platform has a wealth of search indexes available to them for data stored on the server. However, there isn&#8217;t a direct subcommand for displaying the search indexes. The following are automatically created on the server or Platform organization at creation and we know about them already:</p>
<ul>
<li>node</li>
<li>role</li>
<li>client</li>
</ul>
<p>Also, all data bags are created as a search index for the items they contain. All of these indexes are available through the API, and can be retrieved with Knife.</p>
<p><script src="https://gist.github.com/915019.js"></script></p>
<div>This uses knife&#8217;s &#8220;exec&#8221; sub-command. The subcommand takes a script argument, which is a Ruby script. It is executed in the context of the knife configuration, so if you have a .chef/knife.rb, it will be able to connect to a Chef Server. Let&#8217;s look at the contents of this script, it&#8217;s pretty simple.</div>
<p><script src="https://gist.github.com/915020.js"></script></p>
<p>The &#8216;p&#8217; simply prints output of the argument. Then I&#8217;m calling the &#8220;get&#8221; method on the &#8220;api&#8221; object. This is a preconfigured object that knows how to talk to the Chef Server API through the aforementioned configuration. This takes an argument, which I pass the search API endpoint. The results that come back from the API are a Ruby hash, so I print out just the keys by calling the &#8220;keys&#8221; method. As we can see, I have a number of data bags in my environment, including DNS entries, users and Samba (shares and permissions for the curious).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/03/managing-my-workstations-with-chef/">Managing My Workstations With Chef</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-04-03T00:00:00-06:00" pubdate  data-updated="true" >Apr 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><em>Update: <a href="http://jtimberman.posterous.com/update-to-managing-my-workstations">New cookbook, Lion and more</a>!</em></p>
<p>This post describes how I use <a href="http://wiki.opscode.com/display/chef/Home" title="Chef Wiki" target="_blank">Chef</a> and&nbsp;<a href="http://opscode.com/platform/" title="Opscode Platform" target="_blank">Opscode Hosted Chef</a>&nbsp;to manage my workstations, Apple Macbooks. I have three:</p>
<ul>
<li>Company issued Macbook Pro</li>
<li>Personal Macbook Air</li>
<li>Family Macbook Pro</li>
</ul>
<p>Note that while I do use this on my work laptop, Opscode has a different set of recipes to set up development and internal company workstations. At some point there may be a post on the <a href="http://www.opscode.com/blog" title="Opscode Blog" target="_blank">Opscode Blog</a>.</p>
<p>Before I get started with Chef itself, I have to install a few things to &#8220;bootstrap&#8221; the systems to be ready. I&#8217;m not going to include the commands to install all these &#8220;pre-requisites&#8221;, as you can learn how to do that from their respective web sites.</p>
<p><strong><span style="font-size: x-large;">Xcode 3.2 (or 4.0)</span></strong></p>
<p>I wish I could purchase a Macbook with Xcode preinstalled. In fact, I would pay $50 to have this over iLife on new machines, so the $5 cost for version 4 is really minor. However, I don&#8217;t have any use for whatever 4.0 has to offer, since I only want Xcode because its the most sane way to get GCC and friends on OSX.</p>
<p><a href="http://developer.apple.com/xcode/">http://developer.apple.com/xcode/</a></p>
<p><strong><span style="font-size: x-large;">Ruby Version Manager</span></strong></p>
<p>I want to use Ruby 1.9.2 instead of the default that comes with OSX, and RVM makes it easy to do that. I also like the gemset feature, which allows me to sandbox and play with various configurations of RubyGems.</p>
<p><a href="http://rvm.beginrescueend.com">http://rvm.beginrescueend.com</a></p>
<p><strong><span style="font-size: x-large;">Chef</span></strong></p>
<p>I generally just install the latest released Chef gem from RubyGems.org once I have Ruby installed.</p>
<p><a href="https://rubygems.org/gems/chef">https://rubygems.org/gems/chef</a></p>
<p>Once Chef itself is installed, it&#8217;s time to get cooking! I have the following already set up:</p>
<ul>
<li>Opscode Community <a href="http://community.opscode.com/users/jtimberman" title="Joshua Timberman" target="_blank">userid</a>.</li>
<li>Opscode Hosted Chef organization.</li>
<li>Chef Repository</li>
</ul>
<p>Let&#8217;s take a look at what I put into the Chef Repository to configure my workstations. First, I created the repository and the listed components, then I upload everything to my Opscode Hosted Chef organization.</p>
<p><span style="font-size: x-large;"><strong>Cookbooks</strong></span></p>
<p>I have a number of cookbooks for my personal repository, but the relevant ones for workstations are:</p>
<ul>
<li><a href="http://community.opscode.com/cookbooks/dmg" title="dmg cookbook" target="_blank">dmg</a></li>
<li><a href="http://community.opscode.com/cookbooks/homebrew" title="homebrew cookbook" target="_blank">homebrew</a></li>
<li>workstation</li>
</ul>
<p>I wrote the dmg cookbook to automatically install OSX applications that are delivered to users via DMGs. After writing cookbooks for skype, and tunnelblick, I noticed some common patterns and abstracted those out to a lightweight resource and provider, &#8220;dmg_package&#8221;. This does the heavy lifting of:</p>
<ol>
<li>Retrieve a .dmg file from a remote URL.</li>
<li>Mount the disk image.</li>
<li>Copy the .app directory to /Applications.</li>
<li>Unmount the disk image.</li>
</ol>
<p>The homebrew cookbook was written by&nbsp;<span style="line-height: 14px; color: #000000;"><a href="http://community.opscode.com/users/mathie" title="Graeme Mathieson" target="_blank">Graeme Mathieson</a>, and it will install Homebrew in /usr/local and use it as the default package provider on OSX.</span></p>
<p><span style="line-height: 14px; color: #000000;">Both the dmg and homebrew cookbooks were downloaded to my local chef-repo with the &#8220;vendor&#8221; pattern supported by knife.</span></p>
<p><span style="line-height: 14px; color: #000000;">The workstation cookbook consists of a number of recipes. Many of them contain commands lifted from Pivotal Labs experimental GitHub repository, <a href="https://github.com/pivotalexperimental/wschef" title="Pivotal Labs Experimental Chef Workstation Recipes" target="_blank">wschef</a>. I don&#8217;t use any of the scaffolding they wrote in that repository, but I grabbed lots of the executes. However, that repository <a href="https://github.com/pivotalexperimental/wschef/issues/3" title="No License for redistribution of wschef recipes" target="_blank">does not have any mention of a license</a>, so I haven&#8217;t published the workstation cookbook I use. I can publish the recipe I wrote, which will be part of the cookbook when the license of their recipes is sorted out.</span></p>
<p><script src="https://gist.github.com/901008.js"></script></p>
<p><span style="font-size: x-large;"><strong>Roles</strong></span></p>
<p>I use two roles on my workstations that tell Chef what recipes to apply. First, is role[mac_os_x]:</p>
<p><script src="https://gist.github.com/901013.js"></script></p>
<p>Next is the actual workstation recipe.</p>
<p><script src="https://gist.github.com/901012.js"></script></p>
<p><strong><span style="font-size: x-large;">Data Bags</span></strong></p>
<p>Chef is data driven, and I have written a data bag item for my workstation. It simply lists the gems, dmg&#8217;s and packages to install with the above recipe.</p>
<p><script src="https://gist.github.com/901009.js"></script></p>
<p><strong><span style="font-size: x-large;">Client Configuration</span></strong></p>
<p>I run Chef as my normal user, so it will need to be able to write out cache and other files in a location my user has write access. I replace &#8220;workstation_hostname&#8221; for the node name depending on the host. For example, doppelbock is the hostname and node name of my Macbook Air.</p>
<p><script src="https://gist.github.com/901065.js"></script></p>
<p><span style="font-size: x-large;"><strong>Nodes</strong></span></p>
<p>I use the following run list on my workstations.</p>
<p><script src="https://gist.github.com/901014.js"></script></p>
<p><span style="font-size: x-large;"><strong>Upload Chef Repository</strong></span></p>
<p>Now that all the victims are assembled, it is time to upload the Chef repository, copy the configuration file and validation certificate and run Chef.</p>
<p><script src="https://gist.github.com/901076.js"></script></p>
<p>Then I simply run &#8216;chef-client&#8217; as my normal user and my laptop is configured. It does take some time because several of the DMGs are large, and homebrew compiles from source. All in all, it took about 1 hour to do the initial run of Chef on my Macbook Air 13&#8221; when I first set it up.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/02/obligatory-first-post/">Obligatory First Post</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-04-02T00:00:00-06:00" pubdate  data-updated="true" >Apr 2<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My intention is to post about Linux/Unix system administration, Ruby development, Opscode&#8217;s Chef and even more philosophical topics like devops, cloud computing, or really anything that strikes my fancy.</p>
<p>I&#8217;m probably going to post a lot about Chef. Most of this is my own personal exploration of the framework and testing for my personal usage. While I work for Opscode and you&#8217;re free to ask me any time about Chef and the Opscode Platform, I post on this blog in my personal time. Not all the information here is canonical or even reflects the best way to go about doing <strong>anything,</strong>&nbsp;let alone with Chef.</p>
<p>&nbsp;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/04/02/debian-ubuntu-package-for-ruby-1-9-2-with-fpm/">Debian/Ubuntu Package for Ruby 1.9.2 With Fpm</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-04-02T00:00:00-06:00" pubdate  data-updated="true" >Apr 2<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Jordan Sissel created <a href="https://github.com/jordansissel/fpm">fpm</a> a few months ago. It is a quick and easy way to create packages for Debian, Ubuntu and Red Hat family Linux distributions. I created a Ruby 1.9.2 package for my personal server.</p>
<p><script src="https://gist.github.com/881058.js"></script></p>
</div>
  
  


    </article>
  
  <nav class="pagination">
    <div>
      
      <a href="/blog/archives">Blog Archives</a>
      
      <a class="next" href="/">Newer &rarr;</a>
      
    </div>
  </nav>
</div>
<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("jtimberman", 3, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/jtimberman" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @jtimberman</a>
  
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/01/02/chef-report-handler-for-growl/">Chef Report Handler for Growl</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/01/02/switching-to-dnsimple/">Switching to DNSimple</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/24/ruby-in-ubuntu-11-dot-10/">Ruby In Ubuntu 11.10</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/21/chef-on-windows-htpc/">Chef on Windows HTPC</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/09/29/blog-moved-to-github-pages/">Blog Moved to GitHub Pages</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/jtimberman">@jtimberman</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jtimberman',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011-2012 - Joshua Timberman -
  <span class="credit">Powered
  by <a href="http://octopress.org">Octopress</a></span>
  <br /><a rel="license"
  href="http://creativecommons.org/licenses/by-sa/3.0/us/"><img alt="Creative
  Commons License" style="border-width:0"
  src="http://i.creativecommons.org/l/by-sa/3.0/us/80x15.png" /></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/us/">Creative Commons Attribution-ShareAlike 3.0 United States License</a>.
</p>

</footer>
  

<script type="text/javascript">
    (function () {
      var disqus_shortname = 'jtimberman';
      
        
        var disqus_script = 'count.js'
      

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26031299-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>





</body>
</html>
